{{ define "main" }}
<section class="section-padding">
  <div class="container">
    <h2>Dashboard</h2>
    <p><strong>First Name:</strong> <span id="firstName"></span></p>
    <p><strong>Last Name:</strong> <span id="lastName"></span></p>
    <p><strong>Email:</strong> <span id="email"></span></p>
    <p><strong>Organization:</strong> <span id="organization"></span></p>
  </div>
</section>

<script src="/auth0-init.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const client = await window.auth0ClientPromise;
    const isAuthenticated = await client.isAuthenticated();
    if (!isAuthenticated) return window.location.href = "/";

    const idTokenClaims = await client.getIdTokenClaims();
    console.log("Decoded claims:", idTokenClaims);

    const namespace = "https://cgmx.org/";

    document.getElementById("firstName").textContent = idTokenClaims.given_name || "";
    document.getElementById("lastName").textContent = idTokenClaims.family_name || "";
    document.getElementById("email").textContent = idTokenClaims.email || "";
    document.getElementById("organization").textContent = idTokenClaims[`${namespace}organization`] || "";
  });
</script>
{{ end }}
